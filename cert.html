<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrupy Certificate</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Оригинальные стили из Entrupy */
        .loader-spinner {
            display: inline-block;
            width: 80px;
            height: 80px;
        }

        .loader-spinner:after {
            content: " ";
            display: block;
            width: 64px;
            height: 64px;
            margin: 8px;
            border-radius: 50%;
            border: 6px solid #d99302;
            border-color: #d99302 transparent #d99302 transparent;
            animation: loader-spinner 1.2s linear infinite;
        }

        @keyframes loader-spinner {
            0% {
                transform: rotate(0);
            }
            to {
                transform: rotate(360deg);
            }
        }

        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif;
            background: #F0F0F0;
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            line-height: inherit;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .certificate-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .certificate {
            width: 100%;
            height: auto;
            min-height: 1100px;
            background: #F0F0F0;
            border: 12px solid #D99302;
            position: relative;
            padding: 63px 88px;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif;
            font-weight: 400;
        }

        .certificate::before {
            content: '';
            position: absolute;
            top: 24px;
            left: 24px;
            right: 24px;
            bottom: 24px;
            border: 4px solid #D99302;
        }

        .watermark-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.25;
            font-size: 18px;
            font-weight: 500;
            color: rgba(0, 0, 0, 0.3);
            z-index: 1;
            overflow: hidden;
            line-height: 0.9;
            pointer-events: none;
            white-space: nowrap;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;
            letter-spacing: 0;
            padding: 0;
        }

        .certificate-content {
            position: relative;
            z-index: 2;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .certificate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .entrupy-logo {
            font-size: 42px;
            font-weight: 400;
            color: #333;
            letter-spacing: -1px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .verified-seal {
            width: 70px;
            height: 70px;
            position: relative;
        }

        .verified-seal svg {
            width: 100%;
            height: 100%;
        }

        .certificate-title {
            text-align: center;
            font-size: 30px;
            font-weight: 900;
            color: #000;
            margin-bottom: 45px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;
        }

        .product-image {
            width: 380px;
            height: 280px;
            background: #f8f8f8;
            margin: 0 auto 25px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }

        .product-watermark {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 2;
            opacity: 0.4;
            font-size: 16px;
            font-weight: 700;
            color: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;
            letter-spacing: 3px;
            line-height: 1.3;
            text-align: center;
        }

        .product-thumbnails {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .thumbnail {
            width: 60px;
            height: 60px;
            background: #f0f0f0;
            border: 2px solid #D4AF37;
            border-radius: 6px;
            overflow: hidden;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .certificate-info-container {
            margin-bottom: 20px;
            flex-grow: 1;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .info-block {
            background: #fff;
            border-radius: 0;
            padding: 12px 16px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid #f0f0f0;
        }

        .info-label {
            color: #8A8A8A;
            font-size: 14px;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .info-value {
            color: #000;
            font-size: 16px;
            font-weight: 600;
            word-break: break-word;
        }

        .qr-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .qr-text {
            font-size: 13px;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.3;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .qr-code {
            width: 100px;
            height: 100px;
            background: #000;
            margin: 0 auto 20px;
            position: relative;
            border-radius: 3px;
        }

        .qr-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            z-index: 3;
        }

        .qr-logo svg {
            width: 100%;
            height: 100%;
        }

        .certificate-footer {
            font-size: 12px;
            color: #6B6B6B;
            text-align: center;
            line-height: 140%;
            margin-top: auto;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;
            font-weight: 400;
            letter-spacing: 0.012em;
        }

        .certificate-footer a {
            color: #0a89ff;
            text-decoration: none;
        }

        .certificate-footer a:hover {
            text-decoration: underline;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 15px 24px;
            border: 1px solid #BDBDBD;
            border-radius: 44px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease-in;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;
        }

        .print-btn {
            background: #000;
            color: #fff;
            border-color: #000;
        }

        .print-btn:hover {
            background: #fff;
            color: #000;
            border-color: #000;
        }

        .share-btn {
            background: #fff;
            color: #000;
            border-color: #BDBDBD;
        }

        .share-btn:hover {
            background: #000;
            color: #fff;
            border-color: #000;
        }

        .protect-btn {
            background: #D99302;
            color: #fff;
            border-color: #D99302;
        }

        .protect-btn:hover {
            background: #fff;
            color: #D99302;
            border-color: #D99302;
        }

        @media (min-width: 1400px) {
            .certificate {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-gap: 40px;
                padding: 40px 60px;
                min-height: 800px;
            }
            
            .certificate-content {
                grid-column: 1 / -1;
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-gap: 40px;
            }
            
            .certificate-left {
                grid-column: 1;
            }
            
            .certificate-right {
                grid-column: 2;
            }
            
            .certificate-header,
            .certificate-title {
                grid-column: 1 / -1;
            }
            
            .certificate-footer {
                grid-column: 1 / -1;
                margin-top: 40px;
            }
        }

        @media (max-width: 1024px) {
            .container {
                max-width: 95%;
            }
            
            .certificate {
                height: auto;
                min-height: 1000px;
                padding: 20px;
            }
            
            .product-image {
                width: 320px;
                height: 240px;
            }
        }

        @media (max-width: 768px) {
            .certificate {
                height: auto;
                min-height: 900px;
                padding: 24px;
                border: 7px solid #D99302;
            }
            
            .certificate::before {
                top: 10px;
                left: 10px;
                right: 10px;
                bottom: 10px;
            }
            
            .entrupy-logo {
                font-size: 32px;
            }
            
            .certificate-title {
                font-size: 22px;
                margin-bottom: 25px;
            }

            .product-image {
                width: 280px;
                height: 200px;
            }

            .certificate-info-container {
                gap: 0;
                margin-bottom: 20px;
                padding: 10px;
            }

            .product-watermark {
                font-size: 12px;
            }

            .info-label {
                font-weight: 600;
                color: #666;
                padding: 8px 0;
                font-size: 13px;
            }

            .info-value {
                margin-bottom: 12px;
                padding: 4px 0;
                font-size: 13px;
            }

            .verified-seal {
                width: 60px;
                height: 60px;
            }

            .qr-code {
                width: 80px;
                height: 80px;
            }

            .qr-logo {
                width: 16px;
                height: 16px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .certificate-footer {
                font-size: 9px;
                line-height: 1.3;
            }
        }

        @media (max-width: 480px) {
            .container {
                margin: 5px;
            }
            
            .certificate {
                height: auto;
                min-height: 800px;
                padding: 16px;
                border: 4px solid #D99302;
            }

            .certificate-header {
                margin-bottom: 20px;
            }
            
            .entrupy-logo {
                font-size: 28px;
            }
            
            .certificate-title {
                font-size: 18px;
                margin-bottom: 20px;
                letter-spacing: 1px;
            }

            .product-image {
                width: 240px;
                height: 160px;
            }

            .product-thumbnails {
                gap: 10px;
            }

            .thumbnail {
                width: 50px;
                height: 50px;
            }

            .verified-seal {
                width: 50px;
                height: 50px;
            }

            .qr-code {
                width: 70px;
                height: 70px;
            }

            .qr-logo {
                width: 14px;
                height: 14px;
            }

            .certificate-footer {
                font-size: 8px;
                line-height: 1.2;
            }

            .product-watermark {
                font-size: 10px;
            }

            .certificate-info-container {
                padding: 8px;
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .action-buttons {
                display: none;
            }
            
            .certificate-section {
                box-shadow: none;
                padding: 0;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">        
        <div class="certificate-section">
            <div class="certificate" id="certificate">
                <div class="watermark-background" id="watermarkBackground"></div>
                
                <div class="certificate-content">
                    <div class="certificate-header">
                        <div class="entrupy-logo">
                            <span style="font-family: Georgia, serif; font-size: 42px; font-weight: 400; color: #333; letter-spacing: -1px;">entrupy</span>
                        </div>
                        <div class="verified-seal">
                            <svg viewBox="0 0 100 100">
                                <defs>
                                    <path id="star" d="M50,10 L55,35 L75,25 L60,45 L85,55 L60,65 L75,85 L55,75 L50,100 L45,75 L25,85 L40,65 L15,55 L40,45 L25,25 L45,35 Z" fill="#D4AF37"/>
                                    <circle id="inner" cx="50" cy="50" r="35" fill="white"/>
                                </defs>
                                <use href="#star"/>
                                <use href="#inner"/>
                                <path d="M35 50 L45 60 L65 35" stroke="#D4AF37" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                <text x="50" y="75" text-anchor="middle" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif" font-size="8" fill="#D4AF37" font-weight="500">
                                    <tspan x="50" y="75">VERIFIED BY</tspan>
                                    <tspan x="50" y="85">entrupy</tspan>
                                </text>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="certificate-title">CERTIFICATE OF AUTHENTICITY</div>
                    
                    <div class="certificate-left">
                        <div class="product-image" id="productImage">
                            <span id="imagePlaceholder">Product Image</span>
                            <img id="productImg" style="display: none;" alt="Product">
                            <div class="product-watermark" id="productWatermark"></div>
                        </div>
                        
                        <div class="product-thumbnails">
                            <div class="thumbnail" onclick="switchImage(1)">
                                <img id="thumbnail1" style="display: none;" alt="Thumbnail 1">
                                <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 24px;">📷</div>
                            </div>
                            <div class="thumbnail" onclick="switchImage(2)">
                                <img id="thumbnail2" style="display: none;" alt="Thumbnail 2">  
                                <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 24px;">📄</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="certificate-right">
                        <div class="certificate-info-container">
                            <div class="info-block">
                                <div class="info-label">Certificate Holder</div>
                                <div class="info-value" id="cert-holder">Loading...</div>
                            </div>
                            
                            <div class="info-block">
                                <div class="info-label">Brand</div>
                                <div class="info-value" id="cert-brand">Loading...</div>
                            </div>
                            
                            <div class="info-block">
                                <div class="info-label">Material</div>
                                <div class="info-value" id="cert-material">Loading...</div>
                            </div>
                            
                            <div class="info-block">
                                <div class="info-label">Certificate Link</div>
                                <div class="info-value" id="cert-link">Loading...</div>
                            </div>
                            
                            <div class="info-block">
                                <div class="info-label">Certificate Issued At</div>
                                <div class="info-value" id="cert-issued">Loading...</div>
                            </div>
                            
                            <div class="info-block">
                                <div class="info-label">Identifier</div>
                                <div class="info-value" id="cert-identifier">Loading...</div>
                            </div>
                        </div>
                        
                        <div class="qr-section">
                            <div class="qr-text">Scan the QR code to verify the<br>authenticity of the certificate.</div>
                            <div class="qr-code" id="qrCode">
                                <div class="qr-logo">
                                    <svg viewBox="0 0 100 100">
                                        <circle cx="50" cy="50" r="50" fill="#D4AF37"/>
                                        <text x="50" y="65" text-anchor="middle" font-family="Georgia, serif" font-size="60" font-weight="bold" fill="#000">e</text>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="certificate-footer">
                        Trust only the certificates that are hosted on <a href="https://entrupy.com" target="_blank">entrupy.com</a>. Certificates displayed or distributed without Entrupy's authorization are considered invalid as per Entrupy's Terms of Service.<br><br>
                        
                        Entrupy provides a financial guarantee for this certificate. For more information, visit <a href="https://entrupy.com/guarantee" target="_blank">entrupy.com/guarantee</a><br><br>
                        
                        Entrupy offers additional protection plans through XCover for authenticated goods. <a href="#" onclick="protectPurchase()">Learn more here.</a><br><br>
                        
                        Entrupy is not sponsored by or affiliated with any of the designers listed on the Entrupy website. Entrupy's authentication service is based solely on Entrupy's detection algorithm, and the database relied upon is not based upon data provided by any of the designers listed on the Entrupy website. The designers listed on the Entrupy website or application are neither responsible for nor bound by any of the Entrupy's findings and may not honor any certificates of authenticity provided by Entrupy.
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn print-btn" onclick="printCertificate()">🖨 PRINT</button>
                <button class="action-btn share-btn" onclick="shareCertificate()">📤 SHARE</button>
                <button class="action-btn protect-btn" onclick="protectPurchase()">🛡 PROTECT YOUR PURCHASE</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const SUPABASE_CONFIG = {
            url: 'https://iqeddcawonnjoaczalpe.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxZWRkY2F3b25uam9hY3phbHBlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMTEwMTksImV4cCI6MjA3MTg4NzAxOX0.A9ijMdMzPpDq91ppXhBKMF5ZLIz9Zfb6D2o9Hg73usw'
        };

        // Supabase client setup
        class SupabaseClient {
            constructor(url, key) {
                this.url = url;
                this.key = key;
                this.headers = {
                    'apikey': key,
                    'Authorization': `Bearer ${key}`,
                    'Content-Type': 'application/json'
                };
            }

            async select(table, options = {}) {
                let url = `${this.url}/rest/v1/${table}`;
                
                if (options.eq) {
                    const [column, value] = Object.entries(options.eq)[0];
                    url += `?${column}=eq.${value}`;
                }
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: this.headers
                });
                
                if (!response.ok) {
                    throw new Error(`Supabase select error: ${response.status}`);
                }
                
                return response.json();
            }
        }

        // Встроенные данные как fallback
        const CERTIFICATE_DATA = {
            "certificateId": "C4B897R",
            "certificateHolder": "ООО \"Цифровой гардероб\" / Digital Wardrobe LLC",
            "brand": "Hermès",
            "material": "Epsom Leather",
            "issuedDate": "2022-10-26T12:33",
            "identifier": "U (2022)",
            "watermarkText": "C4B897R",
            "productImage1": null,
            "productImage2": null
        };

        // Get certificate ID from URL
        function getCertificateId() {
            const path = window.location.pathname;
            const id = path.substring(1); // Remove leading slash
            return id || 'C4B897R';
        }

        function generateWatermark(text) {
            // Используем номер сертификата как водяной знак (как в оригинале)
            const watermarkText = text || getCertificateId();
            
            // Генерируем фоновые водяные знаки
            const background = document.getElementById('watermarkBackground');
            let watermarkPattern = '';
            
            // Создаем повторяющийся паттерн водяных знаков с номером сертификата
            // Делаем строки точно одинаковыми по длине, заполняя всю ширину
            const lineWidth = 90; // Увеличенная ширина строки в символах
            const textLength = watermarkText.length;
            const fullRepeats = Math.floor(lineWidth / textLength);
            const remainder = lineWidth % textLength;
            
            // Увеличиваем количество строк для полного покрытия высоты сертификата
            for (let row = 0; row < 100; row++) {
                let linePattern = '';
                // Полные повторы текста
                for (let i = 0; i < fullRepeats; i++) {
                    linePattern += watermarkText;
                }
                // Добавляем остаток для точного заполнения строки
                if (remainder > 0) {
                    linePattern += watermarkText.substring(0, remainder);
                }
                watermarkPattern += linePattern + '<br>';
            }
            background.innerHTML = watermarkPattern;
            
            // Генерируем водяной знак на изображении товара
            const productWatermark = document.getElementById('productWatermark');
            if (productWatermark) {
                let productPattern = '';
                for (let i = 0; i < 8; i++) {
                    productPattern += watermarkText + '<br>';
                }
                productWatermark.innerHTML = productPattern;
            }
        }

        async function loadCertificateData() {
            const certificateId = getCertificateId();
            document.title = `Entrupy Certificate - ${certificateId}`;
            console.log('Загружаю сертификат с ID:', certificateId);
            
            let data = null;
            
            try {
                // Пытаемся загрузить данные из Supabase
                if (SUPABASE_CONFIG.url && SUPABASE_CONFIG.anonKey && 
                    SUPABASE_CONFIG.url !== 'https://your-project.supabase.co' && 
                    SUPABASE_CONFIG.anonKey !== 'your-anon-key-here') {
                    
                    console.log('Загружаю данные из Supabase...');
                    const supabase = new SupabaseClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
                    
                    const result = await supabase.select('certificates', { 
                        eq: { certificate_id: certificateId } 
                    });
                    
                    if (result && result.length > 0) {
                        const dbData = result[0];
                        data = {
                            certificateId: dbData.certificate_id,
                            certificateHolder: dbData.certificate_holder,
                            brand: dbData.brand,
                            material: dbData.material,
                            issuedDate: dbData.issued_date,
                            identifier: dbData.identifier,
                            watermarkText: dbData.watermark_text || dbData.certificate_id,
                            productImage1: dbData.product_image1,
                            productImage2: dbData.product_image2
                        };
                        console.log('✅ Данные загружены из Supabase:', data);
                    } else {
                        console.log('🔍 Сертификат не найден в базе данных');
                        throw new Error('Certificate not found in database');
                    }
                } else {
                    console.log('⚠️ Supabase не настроена');
                    throw new Error('Supabase not configured');
                }
                
            } catch (error) {
                console.log('Ошибка загрузки из Supabase, пробую localStorage:', error);
                
                // Fallback: пытаемся загрузить из localStorage
                const savedData = localStorage.getItem('certificateData');
                if (savedData) {
                    const localData = JSON.parse(savedData);
                    data = { ...localData, certificateId: certificateId, watermarkText: certificateId };
                    console.log('💾 Данные загружены из localStorage:', data);
                } else {
                    // Final fallback: встроенные данные
                    data = { ...CERTIFICATE_DATA, certificateId: certificateId, watermarkText: certificateId };
                    console.log('📦 Использую встроенные данные:', data);
                }
            }
            
            if (data) {
                // Заполняем поля данными
                if (data.certificateHolder) document.getElementById('cert-holder').textContent = data.certificateHolder;
                if (data.brand) document.getElementById('cert-brand').textContent = data.brand;
                if (data.material) document.getElementById('cert-material').textContent = data.material;
                if (data.identifier) document.getElementById('cert-identifier').textContent = data.identifier;
                
                // Устанавливаем certificate link с текущим ID
                document.getElementById('cert-link').textContent = `cert.entrupy.com/${certificateId}`;
                
                // Форматируем дату
                if (data.issuedDate) {
                    const date = new Date(data.issuedDate);
                    const formattedDate = date.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) + ' UTC';
                    document.getElementById('cert-issued').textContent = formattedDate;
                }
                
                // Загружаем изображения
                await loadImages(data);
                
                // Генерируем водяные знаки с правильным текстом
                const watermarkText = data.watermarkText || certificateId;
                generateWatermark(watermarkText);
                
                // Генерируем QR код
                generateQRCode(`cert.entrupy.com/${certificateId}`);
            } else {
                // Если данных нет, показываем что сертификат не найден
                document.getElementById('cert-holder').textContent = 'Certificate not found';
                document.getElementById('cert-brand').textContent = 'No data';
                document.getElementById('cert-material').textContent = 'No data';
                document.getElementById('cert-link').textContent = `cert.entrupy.com/${certificateId}`;
                document.getElementById('cert-issued').textContent = 'No data';
                document.getElementById('cert-identifier').textContent = 'No data';
                
                // Показываем placeholder изображения
                showPlaceholder();
                
                generateWatermark(certificateId);
                generateQRCode(`cert.entrupy.com/${certificateId}`);
            }
        }
        
        async function loadImages(data) {
            // Загружаем изображения из base64 данных или файлов
            if (data.productImage1) {
                // Основное изображение
                const productImg = document.getElementById('productImg');
                const imagePlaceholder = document.getElementById('imagePlaceholder');
                
                productImg.src = data.productImage1;
                productImg.style.display = 'block';
                imagePlaceholder.style.display = 'none';
                
                // Thumbnail 1
                const thumb1 = document.getElementById('thumbnail1');
                thumb1.src = data.productImage1;
                thumb1.style.display = 'block';
                thumb1.parentElement.querySelector('div').style.display = 'none';
            }
            
            if (data.productImage2) {
                // Thumbnail 2
                const thumb2 = document.getElementById('thumbnail2');
                thumb2.src = data.productImage2;
                thumb2.style.display = 'block';
                thumb2.parentElement.querySelector('div').style.display = 'none';
            }
            
            // Сохраняем изображения в глобальные переменные для переключения
            currentImages.image1 = data.productImage1;
            currentImages.image2 = data.productImage2;
            
            // Если нет изображений в JSON, пытаемся загрузить из файлов
            if (!data.productImage1 && !data.productImage2) {
                try {
                    const response1 = await fetch('./images/product1.jpg');
                    if (response1.ok) {
                        const blob1 = await response1.blob();
                        if (blob1.size > 100) { // Проверяем что это не пустой файл
                            const imageUrl1 = URL.createObjectURL(blob1);
                            currentImages.image1 = imageUrl1;
                            
                            const productImg = document.getElementById('productImg');
                            const imagePlaceholder = document.getElementById('imagePlaceholder');
                            
                            productImg.src = imageUrl1;
                            productImg.style.display = 'block';
                            imagePlaceholder.style.display = 'none';
                            
                            // Thumbnail 1
                            const thumb1 = document.getElementById('thumbnail1');
                            thumb1.src = imageUrl1;
                            thumb1.style.display = 'block';
                            thumb1.parentElement.querySelector('div').style.display = 'none';
                        }
                    }
                    
                    const response2 = await fetch('./images/product2.jpg');
                    if (response2.ok) {
                        const blob2 = await response2.blob();
                        if (blob2.size > 100) { // Проверяем что это не пустой файл
                            const imageUrl2 = URL.createObjectURL(blob2);
                            currentImages.image2 = imageUrl2;
                            
                            // Thumbnail 2
                            const thumb2 = document.getElementById('thumbnail2');
                            thumb2.src = imageUrl2;
                            thumb2.style.display = 'block';
                            thumb2.parentElement.querySelector('div').style.display = 'none';
                        }
                    }
                } catch (error) {
                    console.log('Could not load images from files');
                }
            }
            
            // Обновляем стили thumbnail'ов
            updateThumbnails();
        }
        
        function setDefaultValues(certificateId) {
            document.getElementById('cert-holder').textContent = 'Certificate Holder';
            document.getElementById('cert-brand').textContent = 'Brand';
            document.getElementById('cert-material').textContent = 'Material';
            document.getElementById('cert-identifier').textContent = 'Verified';
            
            const now = new Date();
            const formattedDate = now.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }) + ' UTC';
            document.getElementById('cert-issued').textContent = formattedDate;
        }
        
        function showPlaceholder() {
            const productImg = document.getElementById('productImg');
            const imagePlaceholder = document.getElementById('imagePlaceholder');
            
            imagePlaceholder.textContent = 'Product Image';
            imagePlaceholder.style.display = 'block';
            productImg.style.display = 'none';
        }

        // Глобальные переменные для изображений
        let currentImages = { image1: null, image2: null };
        let currentActiveImage = 1;

        function switchImage(imageNum) {
            const productImg = document.getElementById('productImg');
            const imagePlaceholder = document.getElementById('imagePlaceholder');
            
            if (imageNum === 1 && currentImages.image1) {
                productImg.src = currentImages.image1;
                productImg.style.display = 'block';
                imagePlaceholder.style.display = 'none';
                currentActiveImage = 1;
                updateThumbnails();
            } else if (imageNum === 2 && currentImages.image2) {
                productImg.src = currentImages.image2;
                productImg.style.display = 'block';
                imagePlaceholder.style.display = 'none';
                currentActiveImage = 2;
                updateThumbnails();
            }
        }

        function updateThumbnails() {
            // Обновляем стили thumbnail'ов для показа активного
            document.querySelectorAll('.thumbnail').forEach((thumb, index) => {
                if (index + 1 === currentActiveImage) {
                    thumb.style.borderColor = '#D4AF37';
                    thumb.style.borderWidth = '3px';
                } else {
                    thumb.style.borderColor = '#D4AF37';
                    thumb.style.borderWidth = '2px';
                }
            });
        }

        function generateQRCode(url) {
            // Создаем точную копию QR кода из оригинального изображения
            const qrCode = document.getElementById('qrCode');
            
            // Паттерн QR кода точно как на изображении
            const qrPattern = [
                "█████████ █ ██ █████████",
                "█       █ █  █ █       █",
                "█ █████ █ ██ █ █ █████ █", 
                "█ █████ █ ██ █ █ █████ █",
                "█ █████ █  █   █ █████ █",
                "█       █ █ ██ █       █",
                "█████████ █ █ ███████████",
                "          ██ █          ",
                "████ █ ██ ██ ███  ██ ███",
                " ██ ██ ████ ██ █ ███  ██",
                "█  ██  █ ███ ████ █ ████",
                "█  █████ ████ ██ ███████",
                "█  █ █ █ ██ █████   █ ██",
                " █████ ████ ████ ███████",
                " █ █ █████  ████ ███ █ █",
                "          █ ██   ██ █   ",
                "█████████ █████ ██ █  ██",
                "█       █  ██ ████ ██ ██",
                "█ █████ █ ██ █ ███ ██ ██",
                "█ █████ █ █ ████ ███ ███",
                "█ █████ █ █████ ████ ███",
                "█       █ ███ ███ ██  ██",
                "█████████  ██ ██ ███ ███"
            ];

            // Создаем SVG QR код
            let svgContent = '<svg viewBox="0 0 230 230" style="width: 100%; height: 100%;">';
            svgContent += '<rect width="230" height="230" fill="white"/>';
            
            const cellSize = 10;
            for (let row = 0; row < qrPattern.length; row++) {
                for (let col = 0; col < qrPattern[row].length; col++) {
                    if (qrPattern[row][col] === '█') {
                        const x = col * cellSize;
                        const y = row * cellSize;
                        svgContent += `<rect x="${x}" y="${y}" width="${cellSize}" height="${cellSize}" fill="black"/>`;
                    }
                }
            }
            svgContent += '</svg>';
            
            qrCode.innerHTML = svgContent + qrCode.innerHTML;
        }

        function printCertificate() {
            window.print();
        }

        function shareCertificate() {
            const certificateLink = document.getElementById('cert-link').textContent;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Entrupy Certificate of Authenticity',
                    text: 'Certificate of Authenticity',
                    url: 'https://' + certificateLink
                }).catch(err => console.log('Error sharing:', err));
            } else if (navigator.clipboard) {
                navigator.clipboard.writeText('https://' + certificateLink).then(() => {
                    alert('Certificate link copied to clipboard!');
                }).catch(() => {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = 'https://' + certificateLink;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('Certificate link copied to clipboard!');
                });
            } else {
                alert('Sharing not supported on this device. Link: https://' + certificateLink);
            }
        }

        function protectPurchase() {
            alert('Redirecting to Entrupy protection plans...\\n\\nThis would typically open entrupy.com/guarantee');
        }

        // Загружаем данные при загрузке страницы
        document.addEventListener('DOMContentLoaded', loadCertificateData);
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>